<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML><HEAD>
<TITLE>rcsvg -- create a stable copy of an RCS cached</TITLE>
<link rel="stylesheet" type="text/css" href="https://carrera.databits.net/~ksb/msrc/css/code.css" />
</HEAD><BODY>
<h1 id="known">To understand this document</h1>
This document assumes you
standard UNIX&trade; shell, <code class="sh">sh</code>(1),
have an understanding of the UNIX process model,
exit codes,
have coded several scripts,
used <code class="sh">gzip</code>(1),
<code class="sh">find</code>(1)

<P>
It also assumes that you can read the manual page for any other
example command.

<h1 id="what">What is <code class="sh">rcsvg</code>?</h1>

<A href="/~ksb/cgi-bin/manpage.cgi?rcsvg"><code class="sh">rcsvg</code></A>
is an add-on to the standard
<acronym title="revision cache system">RCS</acronym> tools.  It selects
a named revision to <code class="sh">co</code> (check out)
from all the cached files in a directory.  The resulting shadow copy
represents a point-in-time snap-shot of the cache, which may be
used to create a <strong>stable build</strong> of the product the
directory represents.

<p>
Since a common numeric revision is unlikely to be available,
the named revision is usually a symbolic name, or the head revision,
which <code class="sh">co</code> represents as a dollar sign
(<code class="markup">$</code>).
The numeric case is allowed, of course, as is selection by
date (under <code class="opt">-d</code>).

<h2 id="basic">Basic examples</h2>

To recover the current sources to <code class="sh">rcsvg</code> itself:
<blockquote class="file"><pre><code >$ <em class="new">cd /usr/msrc/local/bin/rcsvg</em>
$ <em class="new">rcsvg -S /tmp/rcsvg.$USER '$'</em>
$ ls -al /tmp/rcsvg.ksb/
total 76
drwxr-xr-x    2 ksb   wheel    220 Sep 10 11:43 ./
drwxrwxrwt  796 root  wheel  19880 Sep 10 11:43 ../
-rw-r--r--    1 ksb   wheel   2301 Sep 10 11:43 ITO.spec
-rw-r--r--    1 ksb   wheel    374 Sep 10 11:43 Makefile
-rw-r--r--    1 ksb   wheel   1926 Sep 10 11:43 Makefile.host
-rw-r--r--    1 ksb   wheel   1163 Sep 10 11:43 README
-rw-r--r--    1 ksb   wheel    352 Sep 10 11:43 TODO
-rw-r--r--    1 ksb   wheel   1302 Sep 10 11:43 machine.h
<i>...</i>
-rw-r--r--    1 ksb   wheel    169 Sep 10 11:43 util.h</code></pre></blockquote>

<p>
The <code class="sh">cd</code> command above is typical, rather than
providing a <code class="param">source</code> positional parameter.  This is
in keeping with the idea that all RCS commands use the current working
directory as an implicit parameter.  The <code class="param">source</code>
parameter is used mostly by automation, not from the command-line.

<h2 id="why">Why do we need this?</h2>

Engineers and other workers may be working on the source to any configured
item at any time.  We always need to build production work-products
from the stable sources, not some partially committed work-in-progress.
Thus we use stable symbolic labels to fetch a known-good set of
revisions.

<h2 id="called">Called by automation</h2>

<code class="sh">Rcsvg</code> is called by many of my tools to make
<strong>stable</strong> copies of the files that compose both
<acronym title="product">layer 2</acronym> and
<acronym title="packages">layer 3</acronym> sources:
<dl>
<dt id="level2s"><code class="sh">level2s</code> - manage layer 2 products
<dd>
<p>The <code class="sh">level2s</code> product manager (see <A href="/~ksb/cgi-bin/manpage.cgi?level2s&amp;8l">the manual page</A>, or
the <A href="../../sbin/level2s/level2s.html">HTML page</A>) uses
this to cache a copy of each master source directory for the
<code class="markup">build</code> sub-command.
<dt id="level3s"><code class="sh">level3s</code> - manage layer 3 packages
<dd>
<p>The <code class="sh">level3s</code> package manager (see <A href="/~ksb/cgi-bin/manpage.cgi?level3s&amp;8l">the manual page</A>, or
the <A href="../../sbin/level3s/level3s.html">HTML page</A>) uses
this to cache a copy of each master source directory for the
<code class="markup">build</code> sub-command.
<dt id="package">Package recipes fetch level2 products with <code class="sh">rcsvg</code>
<dd>
Each package recipe file has a <code class="sh">make</code> rule to
fetch every individual layer 2 product it includes:
<blockquote><pre><code >${STAGE}/local/bin/mkcmd: ${STAGE}/local/bin
	cd ${MSRC}/local/bin/mkcmd &amp;&amp; <em class="new">rcsvg ${VGOPTS} -S $@ Eight</em></code></pre></blockquote>
<p>
This is where the the symbolic name for each product is associated with
the master source directory which supplies it.  Note that the symbolic name
in the package recipe should be <strong>distinct</strong> from the working
label used by developers or testers.
This is how we provide a <strong>stable copy</strong>,
rather than the current test branch.

<dt id="policy">Site policy - presentation of layer 5 information
<dd>
All of my layer 5 (site policy files) are kept under RCS.  To create stable
presentations the management <code class="sh">make</code> recipes use
<code class="sh">rcsvg</code> and
<acronym title="hyper-text markup language">HTML</acronym> conversion programs.
Therefore the resulting web presentation always agrees with the data
used by automation.
</dl>

<h2 id="summary"></h2>
There is <strong>no magic</strong> here: if you use <code class="sh">git</code>
as your layer 1 revision structure, then you would for a request to
pull a clean copy from your authoritative repository.  That is just
another local site policy you'll have to work through.  Site policy for
revision control is your own business: I provide a simple model using
RCS because it is common and relatively clear.
<h2 id="also">See also</h2>

The <A href="/msrc/Pkgs/msrc_base/msrc.html">top-level</A> master source
document.

<HR><pre>
$Id: rcsvg.html,v 1.3 2012/11/09 20:55:28 ksb Exp $</pre><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"0b68f1a49c894aa1a76d2dc1135097bb","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</BODY></HTML>
